<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ListenHacks Browser Audio DAW</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- Main DAW Area (2/3) -->
      <main class="app">
        <h1>ListenHacks Browser Audio DAW</h1>
        <p>
          Web Audio demo for mic monitoring, recording, playback, looping, and a multitrack timeline.
        </p>
        <p class="message" id="statusMessage"></p>

      <section class="panel">
        <h2>Input & Monitoring</h2>
        <div class="row">
          <button id="enableMicBtn">Enable Mic</button>
          <label>
            <input type="checkbox" id="monitorToggle" disabled />
            Monitor Input (disabled in demo)
          </label>
        </div>
        <div class="meter"><div id="levelFill" class="meter-fill"></div></div>
      </section>

      <section class="panel">
        <h2>Hand Tracking Video</h2>
        <div class="row">
          <button id="toggleHandTrackingBtn" class="secondary">Start Hand Video</button>
          <span>Status: <strong id="handTrackingState" class="value">Off</strong></span>
          <span>Gesture: <strong id="handGestureState" class="value">none</strong></span>
        </div>
        <div class="hand-video-wrap">
          <video id="handTrackingVideo" class="hand-video" autoplay muted playsinline></video>
          <canvas id="handTrackingCanvas" class="hand-video-canvas"></canvas>
        </div>
      </section>

      <section class="grid">
        <div class="panel">
          <h2>Transport</h2>
          <div class="row">
            <button id="startRecordBtn">Start Recording</button>
            <button id="endRecordBtn" class="warn">End Recording</button>
          </div>
          <div class="row">
            <button id="playbackBtn" class="secondary">Playback</button>
            <button id="startLoopBtn" class="secondary">Start Loop</button>
            <button id="endLoopBtn" class="bad">End Loop</button>
          </div>
          <div class="status">
            <span>Recording: <strong id="recordingState" class="value">No</strong></span>
            <span>Looping: <strong id="loopState" class="value">No</strong></span>
            <span>Playback: <strong id="playbackState" class="value">Stopped</strong></span>
            <span>
              Current selected clip length: <strong id="loopLength" class="value">0.00 s</strong>
            </span>
          </div>
        </div>

        <div class="panel">
          <h2>Effects</h2>
          <div class="effects">
            <div class="control">
              <label><input type="checkbox" id="reverbEnabled" /> <span>Reverb (Echo)</span></label>
            </div>
            <div class="control">
              <label><input type="checkbox" id="distortionEnabled" /> <span>Distortion</span></label>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Timeline</h2>
        <div class="status">
          <span>
            Tracks are added as needed while you overdub in loops. Click a clip to select it.
          </span>
        </div>
        <div class="timeline-header">
          <div class="timeline-scale">
            <span>Timeline scale <span id="timelineScaleValue" class="value">80</span> px/s</span>
            <input id="timelineScale" type="range" min="30" max="180" step="1" value="80" />
          </div>
        </div>
        <div class="timeline-shell">
          <div id="timelineAxis" class="time-axis">
            <div class="time-axis-spacer"></div>
            <div id="timelineAxisLane" class="time-axis-lane"></div>
          </div>
          <div id="timelineViewport" class="timeline-viewport">
            <div id="timelinePlayheadLayer" class="timeline-playhead-layer">
              <div id="timelinePlayhead" class="playhead"></div>
            </div>
            <div id="timelineTracks" class="timeline-tracks"></div>
          </div>
        </div>
      </section>

      <span id="remoteStatus" class="remote-status remote-offline" hidden>disconnected</span>
    </main>

    <!-- AI Chatbot Sidebar (1/3) -->
    <aside class="chatbot-sidebar">
      <div class="chatbot-header">
        <h2>ðŸŽµ AI Song Creator</h2>
        <p class="chatbot-subtitle">Chat with me to create your song</p>
      </div>
      
      <div class="chatbot-messages" id="chatMessages">
        <div class="message-bubble assistant">
          <div class="message-content">
            Hi! I'm your AI song creator powered by Gemini. Let's chat about what you're feeling or what's on your mind. When you're ready, just say <strong>"I'M READY"</strong> and I'll create a personalized song from our conversation! ðŸŽ¶
          </div>
        </div>
      </div>

      <div class="chatbot-controls">
        <button id="voiceBtn" class="voice-btn">
          <span class="voice-icon">ðŸŽ¤</span>
          <span class="voice-text">Hold to Talk</span>
        </button>
        <div class="chat-status" id="chatStatus">Ready</div>
      </div>

      <div class="generated-song" id="generatedSong" style="display: none;">
        <h3>Your Song is Ready! ðŸŽµ</h3>
        <audio id="songAudio" controls></audio>
        <div style="display: flex; gap: 8px; margin-top: 8px;">
          <button id="addToTimelineBtn" class="download-btn" style="flex: 1;">Add to Timeline</button>
          <button id="downloadBtn" class="download-btn" style="flex: 1;">Download Song</button>
        </div>
      </div>
    </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/wavesurfer.min.js"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/chatbot.js"></script>
  </body>
</html>
